<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="人人都能用 WAAPI（五）WAAPI 进阶使用"><meta name="keywords" content="音频编程"><meta name="author" content="溪夜,undefined"><meta name="copyright" content="溪夜"><title>人人都能用 WAAPI（五）WAAPI 进阶使用 | 溪夜的音频博客</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 7.3.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-Python-%E4%B8%AD%E9%80%9A%E8%BF%87%E5%BA%95%E5%B1%82%E6%96%B9%E5%BC%8F%E8%B0%83%E7%94%A8-WAAPI"><span class="toc-number">1.</span> <span class="toc-text">在 Python 中通过底层方式调用 WAAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%B8%BA%E4%BD%95%E4%B8%8D%E4%BD%BF%E7%94%A8%E5%B0%81%E8%A3%85%E5%A5%BD%E7%9A%84-waapi-client%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">1.1. 为何不使用封装好的 waapi-client？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BB%80%E4%B9%88%E6%98%AF-autobahn%EF%BC%9F"><span class="toc-number">1.2.</span> <span class="toc-text">1.2. 什么是 autobahn？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E6%89%A7%E8%A1%8C%E7%B1%BB-API-%E8%B0%83%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">1.3. 执行类 API 调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E8%AE%A2%E9%98%85%E7%B1%BB-API-%E8%B0%83%E7%94%A8"><span class="toc-number">1.4.</span> <span class="toc-text">1.4. 订阅类 API 调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84-WAAPI-%E8%B0%83%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">其它语言中的 WAAPI 调用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-JavaScript"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. JavaScript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-C"><span class="toc-number">2.2.</span> <span class="toc-text">2.2. C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-C"><span class="toc-number">2.3.</span> <span class="toc-text">2.3. C++</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E4%B8%AD%E8%B0%83%E7%94%A8-WAAPI"><span class="toc-number">3.</span> <span class="toc-text">在游戏引擎中调用 WAAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9C%A8-Unity-%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. 在 Unity 中调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%BF%9E%E6%8E%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1. 配置与连接测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-JSON-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C-C-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E4%BA%92%E8%BD%AC"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 JSON 字符串和 C# 字符串的互转</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-Functions-%E7%B1%BB-API-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.2. Functions 类 API 使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-Topics-%E7%B1%BB-API-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.1.4.</span> <span class="toc-text">3.1.3. Topics 类 API 使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%9C%A8-Unreal-Engine-%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. 在 Unreal Engine 中调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-Functions-%E7%B1%BB-API-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2. Functions 类 API 使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-Topics-%E7%B1%BB-API-%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3. Topics 类 API 使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%9C%A8-Godot-%E4%B8%AD%E8%B0%83%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">3.3. 在 Godot 中调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E8%AE%B2%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">4.</span> <span class="toc-text">接下来讲什么？</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">溪夜</div><div class="author-info__description text-center">一个 Technical Sound Designer / Sound Engineer / iOS Music Maker / Gearslut / Synth-Lover / Extreme Metal Vocalist / Guitarist / LLer / 惠海人 / 明日香老缠粉 / 音频行业恐怖分子</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">27</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="https://sololand.moe/" target="_blank">zpan的独奏乡</a><a class="author-info-links__name text-center" href="http://jazzlost.me/" target="_blank">李AA的博客</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.cnn.com/cnnnext/dam/assets/170407220916-04-iconic-mountains-matterhorn-restricted.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">溪夜的音频博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/about">About Me</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span></div><div id="post-info"><div id="post-title">人人都能用 WAAPI（五）WAAPI 进阶使用</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-01-15</time><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1.8k</span><span class="post-meta__separator">|</span><span>阅读时长: 7 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>大家好，我是溪夜。<br>在《人人都能用 WAAPI》的第五篇中，与之前相对简单的内容不同，要讨论一些相对进阶的用法。<br>这些内容对于有经验的程序员来说，很可能看一遍官网的示例就能跑通流程。但本系列文章的创作初衷——目标读者更多针对声音设计师或技术音频设计师，在这里我还是会把这些偏进阶的内容用简单的方法讲述一遍，<strong>且会着重解释一些非程序员背景出身的音频设计师容易困扰的部分</strong>。<br>最后，作为对文档中薄弱部分的补充，<strong>本文末尾还会附上在游戏引擎中如何调用 WAAPI 的讲解。</strong><br>希望能够帮助想在 WAAPI 使用上更进一步的朋友们一臂之力，早日走上生产效率更加 Wwiser 的康庄大道。</p>
<p>本文目录：</p>
<p>[toc]</p>
<h2 id="在-Python-中通过底层方式调用-WAAPI"><a href="#在-Python-中通过底层方式调用-WAAPI" class="headerlink" title="在 Python 中通过底层方式调用 WAAPI"></a>在 Python 中通过底层方式调用 WAAPI</h2><blockquote>
<p>注：鉴于 Python 2.X 已经停止维护许久，本章节将只针对 Python 3.X 的进行讲解。有对 Python 2.X 使用有需求的用户可以参考官方文档中相关的部分，并结合本文的讲解一起使用。</p>
</blockquote>
<h3 id="1-1-为何不使用封装好的-waapi-client？"><a href="#1-1-为何不使用封装好的-waapi-client？" class="headerlink" title="1.1. 为何不使用封装好的 waapi-client？"></a>1.1. 为何不使用封装好的 waapi-client？</h3><p>之所以 WAAPI 在 Python 下的使用如此流畅，其实全依赖于 WAAPI 官方 Python 拓展库 <code>waapi-client</code> 的良好封装。许多中间繁琐的调用在其中被解决掉，这样用户才能够用简单的参数实现复杂的调用。<br>对多数用户来说，可能订阅类 API 参数中的回调函数是唯一产生理解难度的概念了，除此之外 WAAPI 在 Python 下的使用体验非常优秀。<br><strong>那么为什么要讨论 autobahn 这个 Python 拓展库呢？</strong><br>试想一下这种情况，当作为技术音频设计师的你需要完全接管 WAAPI 的连接和控制流程的时候，<code>waapi-client</code> 的封装反而存在不利于功能实现的可能性。</p>
<h3 id="1-2-什么是-autobahn？"><a href="#1-2-什么是-autobahn？" class="headerlink" title="1.2. 什么是 autobahn？"></a>1.2. 什么是 autobahn？</h3><p>如果你还记得《人人都能用 WAAPI》第一篇文章中提过的 WAMP 服务器，那么 <code>autobahn</code> 就比较容易理解了。<br>它其实正是 <code>waapi-client</code> 库中负责创建 WAMP 连接的本体，一个 Python 下的 WebSocket（支持双向对话的网络通信协议）框架。<br>我们曾使用 <code>waapi-client</code> 库中封装好的 <code>WaapiClient</code> 类，通过以下代码即可创建 WAMP 连接实例：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> waapi <span class="keyword">import</span> WaapiClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建不带参数的 WAMP 连接</span></span><br><span class="line">client = WaapiClient()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建带参数的 WAMP 连接</span></span><br><span class="line"><span class="comment"># ip 与 port 为 Wwise 中 WAMP 服务器的 IP 与端口</span></span><br><span class="line">client = WaapiClient(<span class="string">&quot;ws://&#123;&#125;:&#123;&#125;/waapi&quot;</span>.<span class="built_in">format</span>(ip, port)）</span><br></pre></td></tr></table></figure><br>如果注意观察 <code>WaapiClient</code> 类的源代码，其中就使用了 <code>autobahn</code> 封装而成的 <code>start_decoupled_autobahn_client</code> 函数。<br>此时如果想通过 <code>autobahn</code> 而不是 <code>WaapiClient</code> 来建立 WAMP 连接的话，则需要使用以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">此处也可使用 from autobahn.asyncio.component import Component, run</span></span><br><span class="line"><span class="string">注：关于 autobahn 的具体使用问题在本篇文章中不展开讨论</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> autobahn.asyncio.wamp <span class="keyword">import</span> ApplicationRunner</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">因没有 WaapiClient 中的防呆设计【client.py（`waapi-client` 的代码文件）第55行】</span></span><br><span class="line"><span class="string">手工创建 WAMP 会话（Session）时需要输入正确的服务器 IP 及端口</span></span><br><span class="line"><span class="string">realm 参数为 WAMP 会话的范围标识符</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">runner = ApplicationRunner(url=<span class="string">u&quot;ws://127.0.0.1:8080/waapi&quot;</span>, realm=<span class="string">u&quot;realm1&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="1-3-执行类-API-调用"><a href="#1-3-执行类-API-调用" class="headerlink" title="1.3. 执行类 API 调用"></a>1.3. 执行类 API 调用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> autobahn.asyncio.wamp <span class="keyword">import</span> ApplicationSession, ApplicationRunner</span><br><span class="line"><span class="keyword">from</span> waapi_uri <span class="keyword">import</span> WAAPI_URI</span><br><span class="line"></span><br><span class="line"><span class="comment"># You may also copy-paste the waapi.py file alongside this sample</span></span><br><span class="line">sys.path.append(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;../../../../../include/AK/WwiseAuthoringAPI/py&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span>(<span class="title class_ inherited__">ApplicationSession</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">onJoin</span>(<span class="params">self, details</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = <span class="keyword">yield</span> <span class="keyword">from</span> <span class="variable language_">self</span>.call(WAAPI_URI.ak_wwise_core_getinfo) <span class="comment"># RPC call without arguments</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;call error: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(ex))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># Call was successful, displaying information from the payload.</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Hello &#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(res.kwresults[<span class="string">&#x27;displayName&#x27;</span>], res.kwresults[<span class="string">&#x27;version&#x27;</span>][<span class="string">&#x27;displayName&#x27;</span>]))</span><br><span class="line">        <span class="variable language_">self</span>.leave()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">onDisconnect</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The client was disconnected.&quot;</span>)</span><br><span class="line">        asyncio.get_event_loop().stop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    runner = ApplicationRunner(url=<span class="string">u&quot;ws://127.0.0.1:8080/waapi&quot;</span>, realm=<span class="string">u&quot;realm1&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        runner.run(MyComponent)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(e).__name__ + <span class="string">&quot;: Is Wwise running and Wwise Authoring API enabled?&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="1-4-订阅类-API-调用"><a href="#1-4-订阅类-API-调用" class="headerlink" title="1.4. 订阅类 API 调用"></a>1.4. 订阅类 API 调用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> autobahn.asyncio.wamp <span class="keyword">import</span> ApplicationSession, ApplicationRunner</span><br><span class="line"><span class="keyword">from</span> waapi_uri <span class="keyword">import</span> WAAPI_URI</span><br><span class="line"></span><br><span class="line"><span class="comment"># You may also copy-paste the waapi.py file alongside this sample</span></span><br><span class="line">sys.path.append(os.path.join(os.path.dirname(__file__), <span class="string">&#x27;../../../../../include/AK/WwiseAuthoringAPI/py&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyComponent</span>(<span class="title class_ inherited__">ApplicationSession</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">onJoin</span>(<span class="params">self, details</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = <span class="keyword">yield</span> <span class="keyword">from</span> <span class="variable language_">self</span>.call(WAAPI_URI.ak_wwise_core_getinfo) <span class="comment"># RPC call without arguments</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;call error: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(ex))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># Call was successful, displaying information from the payload.</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Hello &#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(res.kwresults[<span class="string">&#x27;displayName&#x27;</span>], res.kwresults[<span class="string">&#x27;version&#x27;</span>][<span class="string">&#x27;displayName&#x27;</span>]))</span><br><span class="line">        <span class="variable language_">self</span>.leave()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">onDisconnect</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;The client was disconnected.&quot;</span>)</span><br><span class="line">        asyncio.get_event_loop().stop()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    runner = ApplicationRunner(url=<span class="string">u&quot;ws://127.0.0.1:8080/waapi&quot;</span>, realm=<span class="string">u&quot;realm1&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        runner.run(MyComponent)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">type</span>(e).__name__ + <span class="string">&quot;: Is Wwise running and Wwise Authoring API enabled?&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="其它语言中的-WAAPI-调用"><a href="#其它语言中的-WAAPI-调用" class="headerlink" title="其它语言中的 WAAPI 调用"></a>其它语言中的 WAAPI 调用</h2><h3 id="2-1-JavaScript"><a href="#2-1-JavaScript" class="headerlink" title="2.1. JavaScript"></a>2.1. JavaScript</h3><h3 id="2-2-C"><a href="#2-2-C" class="headerlink" title="2.2. C"></a>2.2. C</h3><h3 id="2-3-C"><a href="#2-3-C" class="headerlink" title="2.3. C++"></a>2.3. C++</h3><h2 id="在游戏引擎中调用-WAAPI"><a href="#在游戏引擎中调用-WAAPI" class="headerlink" title="在游戏引擎中调用 WAAPI"></a>在游戏引擎中调用 WAAPI</h2><h3 id="3-1-在-Unity-中调用"><a href="#3-1-在-Unity-中调用" class="headerlink" title="3.1. 在 Unity 中调用"></a>3.1. 在 Unity 中调用</h3><h4 id="3-1-1-配置与连接测试"><a href="#3-1-1-配置与连接测试" class="headerlink" title="3.1.1. 配置与连接测试"></a>3.1.1. 配置与连接测试</h4><p>想要正常使用 Unity Integration 中的 WAAPI 功能，<strong>首先请确保你的 Wwise 版本大于等于 2018.1，并完成与 Unity 的整合。</strong><br>为了测试方便，建议创建一个全新的工程以方便测试运行脚本。<br>在 Project 选项卡中创建一个新的 C# 脚本命名为 waapi，并修改代码为：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">waapi</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 这里改为 WAMP 服务器的地址和端口，没修改过的话用默认值即可</span></span><br><span class="line">        <span class="keyword">if</span> (AkWaapiClient.Connect(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8080</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Connected to WAMP server&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;Connect fail!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>将其拖拽到 Main Camera 上并运行游戏，如果连接顺利，会在控制台看到以下信息：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Connected to WAMP server</span><br><span class="line">UnityEngine.Debug:Log(Object)</span><br></pre></td></tr></table></figure></p>
<h4 id="3-1-2-JSON-字符串和-C-字符串的互转"><a href="#3-1-2-JSON-字符串和-C-字符串的互转" class="headerlink" title="3.1.2 JSON 字符串和 C# 字符串的互转"></a>3.1.2 JSON 字符串和 C# 字符串的互转</h4><p>因为 WAAPI 的远程调用需要以 JSON 格式传递参数，可以通过文档中提供的<code>WaapiJsonClassBase</code> 类，进行 JSON 与字符串的互相转换：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WaapiJsonClassBase</span>&lt;<span class="title">T</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta"># 重写 ToString() 方法，把返回值改为用 JsonUtility 的 ToJson 方法转换传入的 C# 字符串返回为 JSON 字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> JsonUtility.ToJson(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># 隐式转换</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">implicit</span> <span class="keyword">operator</span> <span class="title">string</span>(<span class="params">WaapiJsonClassBase&lt;T&gt; obj</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> obj.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta"># 使用 JsonUtility 的 FromJson 方法把 JSON 字符串转为 C# 字符串</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T <span class="title">Create</span>(<span class="params"><span class="built_in">string</span> FromJson</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> JsonUtility.FromJson&lt;T&gt;(FromJson);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-1-2-Functions-类-API-使用"><a href="#3-1-2-Functions-类-API-使用" class="headerlink" title="3.1.2. Functions 类 API 使用"></a>3.1.2. Functions 类 API 使用</h4><p>参考：<a href="https://www.audiokinetic.com/zh/library/edge/?source=Unity&amp;id=unity_waapi.html">https://www.audiokinetic.com/zh/library/edge/?source=Unity&amp;id=unity_waapi.html</a></p>
<h4 id="3-1-3-Topics-类-API-使用"><a href="#3-1-3-Topics-类-API-使用" class="headerlink" title="3.1.3. Topics 类 API 使用"></a>3.1.3. Topics 类 API 使用</h4><h3 id="3-2-在-Unreal-Engine-中调用"><a href="#3-2-在-Unreal-Engine-中调用" class="headerlink" title="3.2. 在 Unreal Engine 中调用"></a>3.2. 在 Unreal Engine 中调用</h3><h4 id="3-2-1-配置"><a href="#3-2-1-配置" class="headerlink" title="3.2.1 配置"></a>3.2.1 配置</h4><p>Unreal Integration 默认会自动连接到当前整合的 Wwise 工程中，为了验证这一点，可打开 Project Settings - Integration Settings，查看窗口中的 Auto Connect to WAAPI 是否为勾选状态。<br>在 Wwise - User Settings 中，可以配置用来连接到 WAAPI 服务器的 IP 地址和端口。<br>因为 <code>FAkWaapiClient</code> 需要使用 <code>AkAudio</code> 作为依赖，可以参考文档中的这部分：<a href="https://www.audiokinetic.com/library/edge/?source=SDK&amp;id=waa_cpp_sample.html">https://www.audiokinetic.com/library/edge/?source=SDK&amp;id=waa_cpp_sample.html</a></p>
<h4 id="3-2-2-Functions-类-API-使用"><a href="#3-2-2-Functions-类-API-使用" class="headerlink" title="3.2.2. Functions 类 API 使用"></a>3.2.2. Functions 类 API 使用</h4><h4 id="3-2-3-Topics-类-API-使用"><a href="#3-2-3-Topics-类-API-使用" class="headerlink" title="3.2.3. Topics 类 API 使用"></a>3.2.3. Topics 类 API 使用</h4><h3 id="3-3-在-Godot-中调用"><a href="#3-3-在-Godot-中调用" class="headerlink" title="3.3. 在 Godot 中调用"></a>3.3. 在 Godot 中调用</h3><h2 id="接下来讲什么？"><a href="#接下来讲什么？" class="headerlink" title="接下来讲什么？"></a>接下来讲什么？</h2></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">溪夜</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xiye.art/2021/01/15/WAAPI%20%E4%B8%80%E6%96%87%E9%80%9A%EF%BC%88%E4%BA%94%EF%BC%89/">http://xiye.art/2021/01/15/WAAPI%20%E4%B8%80%E6%96%87%E9%80%9A%EF%BC%88%E4%BA%94%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xiye.art" target="_blank">溪夜的音频博客</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%9F%B3%E9%A2%91%E7%BC%96%E7%A8%8B/">音频编程</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/01/20/Wwise%20%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E6%8C%87%E5%8D%97/"><i class="fa fa-chevron-left">  </i><span>Wwise 文档与官网使用指南</span></a></div><div class="next-post pull-right"><a href="/2021/01/15/WAAPI%20%E4%B8%80%E6%96%87%E9%80%9A%EF%BC%88%E5%9B%9B%EF%BC%89/"><span>人人都能用 WAAPI（四）“元工具”：WAAPI Code Generator</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC80MDk4Ny8xNzUxMg=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2024 By 溪夜</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script><script src="/js/search/local-search.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>