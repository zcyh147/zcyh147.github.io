<!DOCTYPE html><html lang="zh-Hans"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="补完 Reaper 效率链的最后一环（一）ReaScript 基础"><meta name="keywords" content=""><meta name="author" content="溪夜,undefined"><meta name="copyright" content="溪夜"><title>补完 Reaper 效率链的最后一环（一）ReaScript 基础 | 溪夜的音频博客</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.5.6"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css?version=1.5.6"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ReaScript-基础"><span class="toc-number">1.</span> <span class="toc-text">ReaScript 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-补完-Reaper-效率链的最后一环"><span class="toc-number">1.1.</span> <span class="toc-text">1.1. 补完 Reaper 效率链的最后一环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-为什么要做这系列教程"><span class="toc-number">1.2.</span> <span class="toc-text">1.2. 为什么要做这系列教程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-ReaScript-API-基础"><span class="toc-number">1.3.</span> <span class="toc-text">1.3. ReaScript API 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-简介"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1. 简介</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-支持的编程语言"><span class="toc-number">1.4.</span> <span class="toc-text">1.3.2. 支持的编程语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-简单实例"><span class="toc-number">1.5.</span> <span class="toc-text">1.4. 简单实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lua-基础"><span class="toc-number">2.</span> <span class="toc-text">Lua 基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-数据类型"><span class="toc-number">2.1.</span> <span class="toc-text">2.1. 数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-逻辑判断"><span class="toc-number">2.2.</span> <span class="toc-text">2.2. 逻辑判断</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-循环语句"><span class="toc-number">2.3.</span> <span class="toc-text">2.3. 循环语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-循环控制语句"><span class="toc-number">2.4.</span> <span class="toc-text">2.4. 循环控制语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何阅读-ReaScript-文档？"><span class="toc-number">3.</span> <span class="toc-text">如何阅读 ReaScript 文档？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-原版文档与优化后文档的取舍"><span class="toc-number">3.1.</span> <span class="toc-text">3.1. 原版文档与优化后文档的取舍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-原版文档"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1. 原版文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-X-Raym-版优化文档"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2. X-Raym 版优化文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-Mike-Lacey-版-Wiki-文档"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3. Mike Lacey 版 Wiki 文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-如何在文档中找到想要的-API"><span class="toc-number">3.2.</span> <span class="toc-text">3.2. 如何在文档中找到想要的 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-通过实例学习文档的阅读方法"><span class="toc-number">3.3.</span> <span class="toc-text">3.3. 通过实例学习文档的阅读方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过实例学习如何创建带-UI-的-ReaScript-脚本"><span class="toc-number">4.</span> <span class="toc-text">通过实例学习如何创建带 UI 的 ReaScript 脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-如何打开-Reaper-中的开发环境？"><span class="toc-number">4.1.</span> <span class="toc-text">4.1. 如何打开 Reaper 中的开发环境？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-抽象出功能逻辑"><span class="toc-number">4.2.</span> <span class="toc-text">4.2. 抽象出功能逻辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-选择-API"><span class="toc-number">4.3.</span> <span class="toc-text">4.3. 选择 API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-编写功能代码"><span class="toc-number">4.4.</span> <span class="toc-text">4.4. 编写功能代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-绘制-GUI"><span class="toc-number">4.5.</span> <span class="toc-text">4.5. 绘制 GUI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-连接-GUI-与功能代码"><span class="toc-number">4.6.</span> <span class="toc-text">4.6. 连接 GUI 与功能代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-完成效果"><span class="toc-number">4.7.</span> <span class="toc-text">4.7. 完成效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通过举一反三学会更多脚本"><span class="toc-number">5.</span> <span class="toc-text">通过举一反三学会更多脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#致谢"><span class="toc-number">6.</span> <span class="toc-text">致谢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#接下来讲什么？"><span class="toc-number">7.</span> <span class="toc-text">接下来讲什么？</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">溪夜</div><div class="author-info__description text-center">得意时不骄傲，失意时不堕落。</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">21</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">2</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.cnn.com/cnnnext/dam/assets/170407220916-04-iconic-mountains-matterhorn-restricted.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">溪夜的音频博客</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">补完 Reaper 效率链的最后一环（一）ReaScript 基础</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-09-20</time><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">7.3k</span><span class="post-meta__separator">|</span><span>阅读时长: 26 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>大家好，我是溪夜。<br>Reaper 的强大无需多言。无论是 Action List 中琳琅满目的功能，亦或是 SWS Extension 和 ReaPack 带来的超强拓展，对每一个从传统 DAW 转过来的人都是极大的惊喜。<strong>毕竟 Reaper 最大的问题不是它能不能做到，而是你能不能想到。</strong>通常你能想到的问题和需求，都能通过在 Reaper 找到对应功能或脚本来搞定。<br><strong>但你是否好奇过 ReaPack 中那些脚本是怎么写出来的？你是否曾不满于现有的脚本的功能？</strong>这篇文章会帮助你解决这些疑惑，让我们彻底从头学习一下脚本的构建。</p>
<blockquote>
<p>本系列文章阅读需要的前置知识：</p>
<ul>
<li>有一定的英文基础，能够看懂 ReaScript 文档。最好有在 Cockos 论坛上搜索答案的能力。</li>
<li>了解过一门编程语言，有 Lua 基础最好。零基础也不怕，我会快速讲解一下 Lua 语法基础，非常简单。</li>
<li>对 Reaper 的功能比较了解，并已安装好 ReaPack。</li>
<li>掌握基本的 GUI 设计知识。</li>
</ul>
</blockquote>
<p>本文目录：</p>
<p>[toc]</p>
<h2 id="ReaScript-基础"><a href="#ReaScript-基础" class="headerlink" title="ReaScript 基础"></a>ReaScript 基础</h2><h3 id="1-1-补完-Reaper-效率链的最后一环"><a href="#1-1-补完-Reaper-效率链的最后一环" class="headerlink" title="1.1. 补完 Reaper 效率链的最后一环"></a>1.1. 补完 Reaper 效率链的最后一环</h3><p><strong>既然 Reaper 现有的东西已经这么厉害，为什么还要学 ReaScript 来自己写脚本？</strong><br>其实我们很容易发现，在声音设计或者音乐混音的工作中，<strong>很多需求都需要去定制才能做到</strong>，只用现有的脚本和功能是远远不够的。<br>举个例子，在 WAAPI 中有通过“制表符分割文件”进行自动导入音频文件的 API，即通过文本文件中定义的文件名、文件路径、属性等信息，自动导入并创建 Wwise 中的对象。但显然，Reaper 本身没有功能能做到从文件中读取信息并创建轨道且设置相关属性的功能。<br><strong>我们先用脚本小白的思维做一下探索</strong>，试着搜索一下有没有人已经做过类似的脚本。</p>
<ul>
<li>X-Raym 曾做过一个 <code>Import tracks from file</code> 脚本，可以快速的从 txt 或 csv 文件中创建音轨，但这个脚本做不到同时导入音频文件，只能快速创建音轨标题。</li>
<li>继续搜索，会发现他还做过一个付费的脚本 <code>Import items and regions from CSV</code>，功能虽比上一个稍多一点，但也不做不到我们的要求。</li>
</ul>
<p><strong>当然，在这篇文章里我不会讨论搜索技巧，或者如何撞大运找到现成的轮子。</strong><br><strong>我们真正要思考的问题是：</strong></p>
<ol>
<li>现在有个现成的轮子无法满足我们，怎么在它的基础上增改代码以符合我们的需求？</li>
<li>如果真没现成的脚本，该如何从零搭个新的？</li>
</ol>
<p><strong>如果你对技术尚存追求，那么学习 ReaScript 就是你必修的一门 Reaper 功课。</strong></p>
<h3 id="1-2-为什么要做这系列教程"><a href="#1-2-为什么要做这系列教程" class="headerlink" title="1.2. 为什么要做这系列教程"></a>1.2. 为什么要做这系列教程</h3><p>在创作这篇文章之前，国内领域也有一些朋友做了关于 ReaScript 的教程。<strong>比如 Moy 老师曾做过几篇关于 ReaScript 的实例教学</strong>，在知乎、音频应用、声音设计论坛等社区中也有些朋友在分享自己所做的脚本。<br>之所以我还要做一系列新的教程，原因有几点：</p>
<ol>
<li><strong>这个领域应该有一套更友好且更系统的教程</strong>，尤其要解答初学者在学习与使用 ReaScript 时的一些疑惑。</li>
<li>补充一些重要的内容，比如<strong>阅读文档的方法、给脚本设计 UI、在 Reaper 外调用 ReaScript 等。</strong></li>
<li>奔着开源精神触发，<strong>我希望更多有创意的脚本被大家开发出来。</strong></li>
</ol>
<p>下面就让我们一起先从 ReaScript 基础开始。</p>
<h3 id="1-3-ReaScript-API-基础"><a href="#1-3-ReaScript-API-基础" class="headerlink" title="1.3. ReaScript API 基础"></a>1.3. ReaScript API 基础</h3><h4 id="1-3-1-简介"><a href="#1-3-1-简介" class="headerlink" title="1.3.1. 简介"></a>1.3.1. 简介</h4><p>ReaScript API 是 Reaper 中重要的功能补充，与 Action 的不同之处就是它更贴近底层。我们都知道，Reaper 的 Action 能瞬间完成一个具体的功能（这个功能实际上帮你一下子完成了多个功能步骤)。但在 API 中想是做到同样的效果，就要把这个功能拆解成<strong>细小步骤</strong>，并用代码实现每一步的操作后才能做到同样的事情。<br><strong>Action 和在 ReaPack 中下载的诸多脚本其实一样，本质上是一种对底层多步骤操作的封装。</strong>而我们“做脚本”这件事，就是重新封装属于我们自己的“功能想象”。<br>拿 <code>Item edit: Move position of item under mouse to edit cursor</code> 举例，当我们执行这个 Action，当前鼠标光标下的对象会直接移动到光标处，听起来似乎非常简单。<br><strong>但如果用脚本来实现，步骤就多了很多：</strong></p>
<ol>
<li>获取鼠标下的对象：<code>BR_GetMouseCursorContext_Item()</code></li>
<li>获取游标的位置：<code>GetCursorPosition()</code></li>
<li>把对象的左边缘移动到游标的位置：<code>SetMediaItemInfo_Value()</code></li>
</ol>
<p>可以看到，除了把这个 Action 拆成了三个步骤外，我还找到了对应的 API 功能，这是复刻这条 Action 的基础。<br>Reaper 脚本的原理，即<strong>要想办法把我们的需求不断拆解，最终达到每个细节步骤都能通过调用一条 API 完成（如上例所示）。</strong>最后再通过基本的程序结构为它们设计执行逻辑，就能得到具有功能性的脚本。</p>
<ul>
<li><strong>把大象放进冰箱需要三步，打开冰箱门，把大象放进去，把冰箱门关上。</strong></li>
</ul>
<p>很多人都听说过小品中的这句话，但可思考过它背后的逻辑？<strong>拆解一个看似想当然的行为，这也是脚本开发的基础逻辑。</strong><br>而事实上把大象放进冰箱里还有着很多前提：<br>冰箱（容器）能否装载这么大的动物（数据类型），这个大象是否需要麻醉（类似 Profiler 中时间点的概念），通过什么工具运载大象到冰箱里（中间变量，甚至压缩算法）……<br><strong>让读者有能力进行功能的拆解和找到对应的 API，这也是本系列文章所讲解的一个重点。</strong>我认如果你学明白这部分，剩下的组装程序与 GUI 开发其实也就没什么难度了。<br>Reaper 脚本开发的另一个优势在于已它已内置了编码工具，不需要配置开发环境就能直接在内部进行脚本编程（此处不包括 Python）。甚至，无需 Juce 这种框架就能进行插件（JSFX）的开发。<br><img src="/images/reaper%E5%BC%80%E5%8F%91.png" alt="reaper开发"></p>
<p>上图为我在脚本开发时的截图。虽图片被压缩，但仍容易看出，凭 Reaper 和 ReaPack 提供的开发工具，我们在 Reaper 中能获得从代码到 GUI 构建器一整套开发工作流。</p>
<h3 id="1-3-2-支持的编程语言"><a href="#1-3-2-支持的编程语言" class="headerlink" title="1.3.2. 支持的编程语言"></a>1.3.2. 支持的编程语言</h3><p>ReaScript 支持三种脚本编程语言，分别是 Reaper 自有的 EEL、Lua 和 Python（2.7-3.X）。其中 EEL 不仅可用于 ReaScript 的开发，亦可用于 JS 插件的开发。（ReaScript 对于 C/C++ 也有支持，但在本文暂不予讨论）。<br><strong>本文会着重讨论 ReaScript 通过 Lua 的实现。</strong>因为本人目前不熟悉 EEL，且 Python 在 Reaper 内的性能没有 EEL 或 Lua 好，亦无法实现 UI 或图形显示。<br>不过对于在 Reaper 外调用 API 我们会在下一篇有额外的讨论，在那里我们会用到 Python。</p>
<h3 id="1-4-简单实例"><a href="#1-4-简单实例" class="headerlink" title="1.4. 简单实例"></a>1.4. 简单实例</h3><p>既然是实例，我希望更有针对性。作为国际惯例，先从 Hello Reaper 开始。<br>这种基本的字符串输出实例的意义就是一条，代表你跑通了当前的开发环境。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reaper.ShowConsoleMsg(<span class="string">"Hello Reaper!"</span>)</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/Hello%20Reaper.png" alt="Hello Reaper"><br>执行这句代码可看到如上的返回结果。</p>
<p>之后回过来看一下开头提到的那条 Action：<code>Item edit: Move position of item under mouse to edit cursor</code>。我们通过 ReaScript 复刻一下它的功能，这种学习方式会让你对它的功能实现过程认识的更加深刻。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">item = reaper.BR_GetMouseCursorContext_Item()</span><br><span class="line">cursor_pos = reaper.GetCursorPosition()</span><br><span class="line">reaper.SetMediaItemInfo_Value(item, <span class="string">"D_POSITION"</span>, cursor_pos)</span><br></pre></td></tr></table></figure></p>
<p>执行上面的脚本后，我们发现鼠标下面的对象如期望的移动到了光标处。<br>严格来说，这个脚本还需要加上 Undo_BeginBlock() 和 Undo_EndBlock() 以满足 Reaper 的撤销记录功能。否则执行脚本后会无法撤销，这些暂且不加以讨论。<br><strong>可能你还看不懂这部分代码，甚至不知道怎么执行它，不要担心，看完这篇文章后你就能轻松写出这样的脚本。</strong></p>
<h2 id="Lua-基础"><a href="#Lua-基础" class="headerlink" title="Lua 基础"></a>Lua 基础</h2><p><strong>为了照顾没接触过 Lua 的朋友，下面我们简单讲解一下它的基本语法。</strong>如果已有 Lua 基础，请直接跳到本文第三部分“如何阅读 ReaScript 文档”。<br>Lua 作为一门上手容易的的脚本语言，无论是在 ReaScript 开发还是在使用 xLua 这种热更新框架时都会用到。与 Python 类似，Lua 的语法并不复杂，学习成本很低。</p>
<h3 id="2-1-数据类型"><a href="#2-1-数据类型" class="headerlink" title="2.1. 数据类型"></a>2.1. 数据类型</h3><p>nil：表示没有任何有效值。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 打印尚未赋值的变量 a，可得到返回值 nil</span></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- result: </span></span><br><span class="line"><span class="literal">nil</span></span><br></pre></td></tr></table></figure></p>
<p>boolean：在 Lua 中布尔值的假对应的只有 false 和 nil，其余所有的均为真（包括数字0）.<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="literal">nil</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"0 = true"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"0 = false"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- result:</span></span><br><span class="line">boolean</span><br><span class="line"><span class="number">0</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure></p>
<p>number：数字类型，在 Lua 5.2 之前均为双精度浮点型，在之后分为64位整型 integer 和双精度浮点型 float，但它们也属于 number 类型。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 分别输出不带小数点和带小数点的数字类型</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(<span class="number">3.0</span>))</span><br><span class="line"><span class="comment">-- 通过 math 模块判断数字是整型或浮点类型</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">math</span>.<span class="built_in">type</span>(<span class="number">3</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">math</span>.<span class="built_in">type</span>(<span class="number">3.0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- result:</span></span><br><span class="line">number</span><br><span class="line">number</span><br><span class="line">integer</span><br><span class="line">float</span><br></pre></td></tr></table></figure></p>
<p>string：字符串，单引号或双引号均可定义字符串内容。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string1 = <span class="string">"string1"</span></span><br><span class="line">string2 = <span class="string">'string2'</span></span><br></pre></td></tr></table></figure></p>
<p>table：Lua 中的表与 Python 中的列表不同，table 还可以通过添加索引（数字或字符串）作为字典（关联数组）来使用.<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建空 table，</span></span><br><span class="line">tbl1 = &#123;&#125;</span><br><span class="line"><span class="comment">-- 直接初始化 table 并打印其中的元素，打印 table 指定索引之间的字符串。注意：Lua 的初始索引以1开始，而不是0。</span></span><br><span class="line">tbl2 = &#123;<span class="string">"obj1"</span>, <span class="string">"obj2"</span>, <span class="string">"obj3"</span>, <span class="string">"obj4"</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(tbl2[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">table</span>.<span class="built_in">concat</span>(tbl2, <span class="string">","</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建空 table，并指派一个键值对 a: 20</span></span><br><span class="line">associative_arrays = &#123;&#125;</span><br><span class="line">key = <span class="string">"a"</span></span><br><span class="line">associative_arrays[key] = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 打印 associative_arrays 中键值对，并分别通过变量 key 与字符串 a 来索引 table</span></span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(associative_arrays) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(k .. <span class="string">" : "</span> .. v)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">print</span>(associative_arrays[key])</span><br><span class="line"><span class="built_in">print</span>(associative_arrays.a)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- result:</span></span><br><span class="line">obj1</span><br><span class="line">obj2,obj3</span><br><span class="line">a : <span class="number">20</span></span><br><span class="line"><span class="number">20</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure></p>
<p>function：函数。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不含参数的函数：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add_numbers</span><span class="params">()</span></span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">2</span></span><br><span class="line">    c = a + b</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 含参数的函数：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add_numbers</span><span class="params">(a, b)</span></span></span><br><span class="line">    c = a + b</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>thread：线程，表示执行的独立线路，用于执行协同程序。<br>userdata：用户自定义数据类型，可将 C/C++ 的任意数据类型的数据存储到 Lua 变量中调用。</p>
<h3 id="2-2-逻辑判断"><a href="#2-2-逻辑判断" class="headerlink" title="2.2. 逻辑判断"></a>2.2. 逻辑判断</h3><p>if 语句：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a &lt; <span class="number">20</span>)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 小于20"</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>if…else 语句：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a &lt; <span class="number">20</span>)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 小于20"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 大于20"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>if…elseif…else 语句：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(a == <span class="number">10</span>)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 的值为10"</span>)</span><br><span class="line"><span class="keyword">elseif</span>(a == <span class="number">20</span>)</span><br><span class="line"><span class="keyword">then</span>  </span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 的值为20"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"没有匹配 a 的值"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-3-循环语句"><a href="#2-3-循环语句" class="headerlink" title="2.3. 循环语句"></a>2.3. 循环语句</h3><p>while 循环：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 当 a 小于20时持续执行循环体</span></span><br><span class="line"><span class="keyword">while</span>(a &lt; <span class="number">20</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 的值为:"</span>, a)</span><br><span class="line">   a = a + <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>数值 for 循环：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 没设置递增步长的 for 循环，每执行一次执行体后以1为单位递增 i</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>,<span class="number">5</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以-1为递增步长的 for 循环，每执行一次执行体后以1为单位递增 -1</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">10</span>,<span class="number">1</span>,<span class="number">-1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>泛型 for 循环：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">"apple"</span>, <span class="string">"banana"</span>, <span class="string">"cherry"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过迭代器函数 ipairs 来遍历所有值</span></span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i, v)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>repeat…until：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 持续执行循环体，直到 a 大于20时跳出循环</span></span><br><span class="line"><span class="keyword">repeat</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">"a 的值是："</span>, a)</span><br><span class="line">   a = a + <span class="number">1</span></span><br><span class="line"><span class="keyword">until</span>(a &gt; <span class="number">20</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="2-4-循环控制语句"><a href="#2-4-循环控制语句" class="headerlink" title="2.4. 循环控制语句"></a>2.4. 循环控制语句</h3><p>break 语句：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当 i 小于3时跳出循环体</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">10</span>,<span class="number">1</span>,<span class="number">-1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">if</span> (i &lt; <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>goto 语句：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设定 label</span></span><br><span class="line">::label:: <span class="built_in">print</span>(<span class="string">"a = "</span>, a)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 当 a 小于3的时候跳转到 label</span></span><br><span class="line"><span class="keyword">if</span> a &lt; <span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">goto</span> label </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h2 id="如何阅读-ReaScript-文档？"><a href="#如何阅读-ReaScript-文档？" class="headerlink" title="如何阅读 ReaScript 文档？"></a>如何阅读 ReaScript 文档？</h2><h3 id="3-1-原版文档与优化后文档的取舍"><a href="#3-1-原版文档与优化后文档的取舍" class="headerlink" title="3.1. 原版文档与优化后文档的取舍"></a>3.1. 原版文档与优化后文档的取舍</h3><h4 id="3-1-1-原版文档"><a href="#3-1-1-原版文档" class="headerlink" title="3.1.1. 原版文档"></a>3.1.1. 原版文档</h4><p>两种打开方法：</p>
<ol>
<li>打开 Help 菜单，点击 ReaScript documentation</li>
<li>直接访问 <a href="https://www.reaper.fm/sdk/reascript/reascripthelp.html" target="_blank" rel="noopener">https://www.reaper.fm/sdk/reascript/reascripthelp.html</a></li>
</ol>
<p>对于原版文档，建议大家采用第一种方法。官网的在线的 API 版本还停留在 Reaper 5 时代，时效性很差。<br><img src="/images/%E4%B8%91%E9%99%8B%E7%9A%84%20API%20%E6%96%87%E6%A1%A3.png" alt="丑陋的 API 文档"><br>丑陋的原版文档</p>
<p>不难发现，ReaScript API 原版文档过于简陋，排版很难看，不便于使用。<strong>但原版文档，尤其是本机自带的原版文档具有最佳的时效性。</strong></p>
<h4 id="3-1-2-X-Raym-版优化文档"><a href="#3-1-2-X-Raym-版优化文档" class="headerlink" title="3.1.2. X-Raym 版优化文档"></a>3.1.2. X-Raym 版优化文档</h4><p>为了解决原版文档过于简陋的问题，X-Raym 做了一个优化版本的文档：<br><a href="https://www.extremraym.com/cloud/reascript-doc/" target="_blank" rel="noopener">https://www.extremraym.com/cloud/reascript-doc/</a><br><img src="/images/x-raym%E7%89%88%20%E6%96%87%E6%A1%A3.png" alt="x-raym版 文档"></p>
<p>X-Raym 整理的这版文档的排版与格式都是上等，<strong>并人性化的在左侧放置了搜索框。</strong>这也是我主力推荐的版本。唯一的小缺点是更新稍有不及时，比如在本文发布的时间下 X-Raym 的这版文档停留在了5月3日。<br>如果有对文档时效性的需求（一般来说看这版足矣），还是请以官方文档为准。</p>
<h4 id="3-1-3-Mike-Lacey-版-Wiki-文档"><a href="#3-1-3-Mike-Lacey-版-Wiki-文档" class="headerlink" title="3.1.3. Mike Lacey 版 Wiki 文档"></a>3.1.3. Mike Lacey 版 Wiki 文档</h4><p>Mike Lacey 在09年创建了 Reaper Wiki，其中也包括 ReaScript Wiki，但很久未更新。除非有朋友对 Wiki 有执念，否则不推荐这版本。<br>地址：<a href="https://wiki.cockos.com/wiki/index.php/ReaScript" target="_blank" rel="noopener">https://wiki.cockos.com/wiki/index.php/ReaScript</a><br><img src="/images/%E8%8D%92%E5%BA%9F%E7%89%88%E6%96%87%E6%A1%A3.png" alt="荒废版文档"><br>许久不更新的 ReaScript Wiki</p>
<h3 id="3-2-如何在文档中找到想要的-API"><a href="#3-2-如何在文档中找到想要的-API" class="headerlink" title="3.2. 如何在文档中找到想要的 API"></a>3.2. 如何在文档中找到想要的 API</h3><p>ReaScript 的 API 数量庞大，算上扩展 API 近千个，显然是没有什么好方法去整理的。我曾试过通过思维导图进行分类，但因数量庞大，实在没有精力像 WAAPI 那样通过导图进行详细分类。<br>但是要知道，<strong>ReaScript 有些 API 可能你一辈子用不上，</strong>所以明确自己的目的，寻找自己需要的 API 才是对的，而不是被庞大的 API 列表所击打。<br><strong>一个简略且有效的文档查找步骤是：</strong></p>
<ol>
<li>在逻辑抽象阶段想明白自己要的功能是什么分类，并抽象出关键词，如<code>get</code>、<code>media</code>、<code>midi</code>、<code>takefx</code>等。</li>
<li>利用 X-Raym 版优化文档强大的搜索功能，通过组合词搜索找到目标 API。</li>
<li>在现有的脚本中查找功能相似的，学习它们的 API 调用。</li>
<li>善用 Google。</li>
</ol>
<h3 id="3-3-通过实例学习文档的阅读方法"><a href="#3-3-通过实例学习文档的阅读方法" class="headerlink" title="3.3. 通过实例学习文档的阅读方法"></a>3.3. 通过实例学习文档的阅读方法</h3><p>相信大家也发现 ReaScript 的脚本出了名的简略，我以富有代表性的 API 作为例子分析一下，先看 <code>GetTrackName</code> 这条 API 在文档中的介绍：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">boolean retval, <span class="built_in">string</span> buf = reaper.GetTrackName(MediaTrack track)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Returns "MASTER" for master track, "Track N" if track has no name.</span></span><br></pre></td></tr></table></figure></p>
<p>根据文档我们可知，它的返回值有两个，一个是布尔类型的取回结果，一个是字符串类型的轨道名。文档中已注明特例的返回值，对于 master track 会返回 <code>MASTER</code>，如果轨道没有名字则会返回 <code>Track N</code>，看到这里似乎一切还很简单。<br><strong>但是请注意，它的参数是 <code>MediaTrack track</code>，如果你想当然的用鼠标选择一条轨道后就直接执行这条 API，并不会得到想要的轨道名，这是为什么？</strong><br>如果还记得“大象放进冰箱需要几步”就会明白，目前步骤细分的还不够。<strong>实际上这个 API 需要的参数是 MediaTrack 类型的轨道对象。</strong>所以如果想流畅使用 <code>GetTrackName</code>，先要想办法弄到这个 MediaTrack 类型的轨道对象。<br>通过在文档中搜索 MediaTrack，我们定位到另外一条 API：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MediaTrack reaper.GetTrack(ReaProject proj, integer trackidx)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- get a track from a project by track count (zero-based) (proj=0 for active project)</span></span><br></pre></td></tr></table></figure></p>
<p>终于，这条 API 的返回值是我们需要的 MediaTrack 对象，而它需要的输入值分别是工程编号及轨道编号。<br>我们用以下代码进行测试：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">track1 = reaper.GetTrack(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">track2 = reaper.GetTrack(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">retval1, name1 = reaper.GetTrackName(track1)</span><br><span class="line">retval2, name2 = reaper.GetTrackName(track2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(track1, track2)</span><br><span class="line"><span class="built_in">print</span>(retval1, name1)</span><br><span class="line"><span class="built_in">print</span>(retval2, name2)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- result</span></span><br><span class="line">&lt;userdata: <span class="number">0x7fee19b28000</span>&gt;</span><br><span class="line">&lt;userdata: <span class="number">0x7fea89a58000</span>&gt;</span><br><span class="line"><span class="literal">true</span>  <span class="string">"Footsteps_Wood"</span></span><br><span class="line"><span class="literal">true</span>  <span class="string">"Track 1"</span></span><br></pre></td></tr></table></figure></p>
<p>由结果可见，我们成功的获取了轨道名。<br>实际上，<strong>通过这个例子你就已经学会了在 ReaScript API 阅读时的两个重要技巧：</strong></p>
<ol>
<li>当遇到不认识的参数时，要一步一步逆推出它的获取 API。</li>
<li>如果函数有不止一个返回值，需要用多个变量去接收其返回值。</li>
</ol>
<h2 id="通过实例学习如何创建带-UI-的-ReaScript-脚本"><a href="#通过实例学习如何创建带-UI-的-ReaScript-脚本" class="headerlink" title="通过实例学习如何创建带 UI 的 ReaScript 脚本"></a>通过实例学习如何创建带 UI 的 ReaScript 脚本</h2><p>其实通过“简单实例”与“通过实例学习文档的阅读方法”中的两段程序，我们已经走完了脚本开发的整套流程。但为了演示关于 GUI 设计的部分，我们做一个简单的程序来体验一下在 Reaper 中做 GUI 有多么容易。<br>绝大多数功能性脚本其实都不需要 GUI 的介入，但如果你要做一个 Variato（Nikola Lukic 开发的一个对选中区域内对象进行位置和属性随机化的插件）这样的工具。<strong>脚本工作时需要用户指定一些属性，那么这时候制作一个 GUI 就十分有必要了。</strong><br>为了让脚本有接收用户输入值需求，我们设计一个最简单的需求，把当前框选的所有 items 统一设置为用户需要的音量。</p>
<h3 id="4-1-如何打开-Reaper-中的开发环境？"><a href="#4-1-如何打开-Reaper-中的开发环境？" class="headerlink" title="4.1. 如何打开 Reaper 中的开发环境？"></a>4.1. 如何打开 Reaper 中的开发环境？</h3><p>在开始之前，我们先看看 Reaper 中会用到的开发环境，主要有两个。<br>其一是 ReaScript 自带的开发环境，第二是 ReaPack 中的交互式开发环境。<br><img src="/images/reascript%20editor.png" alt="reascript editor"><br>系统自带的脚本编辑器<br><img src="/images/%E4%BA%A4%E4%BA%92%E5%BC%8FLua.png" alt="交互式Lua"><br>cfillion 开发的 Interactive ReaScript<br>不难看出，系统自带的脚本编辑器会是我们开发时的主力工具。<br><strong>而Interactive ReaScript 作为交互式开发环境，更多是为了让我们方便试用 Lua 命令而开发。</strong>如果你想快速的尝试一些 API 功能，而不想打开编辑器大费周章，建议你使用这个。<br><strong>如果想在 VS Code 中进行开发，</strong>可安装 Lokasenna 开发的 Reaper tools for Visual Studio Code 进行自动补全，不过此版本已经两年未更新新的 API。我更建议使用 slsenseless 开发的 ReaScriptDocParser，与现有文档的同步速度会更好。这两者对 ReaScript 所支持的所有语言都具有自动补全，可按需选用。<br>Reaper tools for Visual Studio Code：<a href="https://github.com/jalovatt/reaper-vs-code" target="_blank" rel="noopener">https://github.com/jalovatt/reaper-vs-code</a><br>ReaScriptDocParser：<a href="https://github.com/slsenseless/ReaScriptDocParser/" target="_blank" rel="noopener">https://github.com/slsenseless/ReaScriptDocParser/</a></p>
<h3 id="4-2-抽象出功能逻辑"><a href="#4-2-抽象出功能逻辑" class="headerlink" title="4.2. 抽象出功能逻辑"></a>4.2. 抽象出功能逻辑</h3><p>在例子中，我们做一个简单的程序。当用户选择了 N 个媒体对象时，在程序中输入想要的目标音量值，点击按钮，就会自动执行脚本。当然，我需要它带 GUI。<br>首先抽象出脚本的功能逻辑：</p>
<ol>
<li>添加 Undo 开始块</li>
<li>获取用户的分贝输入值，并判断是否超过正常范围</li>
<li>判断用户选定的范围内是否有 item，如果没有及时报错</li>
<li>分别对每一个 item 执行音量设置</li>
<li>结束 Undo 块记录</li>
</ol>
<h3 id="4-3-选择-API"><a href="#4-3-选择-API" class="headerlink" title="4.3. 选择 API"></a>4.3. 选择 API</h3><p>依次填入对应的 API：</p>
<ol>
<li>添加 Undo 开始块：Undo_BeginBlock()</li>
<li>获取用户的分贝输入值，并判断是否超过正常范围：GUI.Val()</li>
<li>判断用户选定的范围内是否有 item，如果没有及时报错：GetSelectedMediaItem()</li>
<li>分别对每一个 item 执行音量设置：SetMediaItemInfo_Value()</li>
<li>结束 Undo 块记录：Undo_EndBlock()</li>
</ol>
<h3 id="4-4-编写功能代码"><a href="#4-4-编写功能代码" class="headerlink" title="4.4. 编写功能代码"></a>4.4. 编写功能代码</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建空表 sel_item，用来存储选中的媒体对象</span></span><br><span class="line">sel_item = &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 1. 音量换算函数，把用户输入的分贝数 dB_input 换算成数字音量 vol_value</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ValFromdB</span><span class="params">(dB_input)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>^(dB_input/<span class="number">20</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2. 对象音量调整函数，参数为数字音量值 vol_value</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">VolChanger</span><span class="params">(vol_value)</span></span></span><br><span class="line">    reaper.Undo_BeginBlock()</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 保存选取的媒体对象在字典 sel_item 中</span></span><br><span class="line">  <span class="keyword">for</span> i = <span class="number">1</span>, count_sel_items <span class="keyword">do</span></span><br><span class="line">    sel_item[i] = reaper.GetSelectedMediaItem(<span class="number">0</span>, i - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- 对字典中的每一个对象执行音量改变操作</span></span><br><span class="line">  <span class="keyword">for</span> w = <span class="number">1</span>, #sel_item <span class="keyword">do</span></span><br><span class="line">    reaper.SetMediaItemInfo_Value(sel_item[w], <span class="string">"D_VOL"</span>, vol_value)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    reaper.Undo_EndBlock(<span class="string">"Batch Volumes"</span>, <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3. 输入值判断函数，因为推子最高为12 dB，需要判断用户的输入值是否在范围内并设置临界值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">input_cal</span><span class="params">(vol_value)</span></span></span><br><span class="line">    <span class="keyword">if</span> (vol_value &gt; <span class="number">12</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- 根据我的取小数算法12.05正好转换为12 dB</span></span><br><span class="line">        VolChanger(<span class="number">12.05</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        VolChanger(vol_value)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4. 主函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span></span>    </span><br><span class="line">    <span class="comment">-- 计算当前选中的对象数</span></span><br><span class="line">    count_sel_items = reaper.CountSelectedMediaItems(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 选取对象不为0才执行函数，否则弹窗提醒</span></span><br><span class="line">    <span class="keyword">if</span> count_sel_items &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> t = <span class="built_in">type</span>(dB_input)</span><br><span class="line">        <span class="keyword">if</span> t == <span class="string">"number"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- 对分贝换算后的值保留1位小数</span></span><br><span class="line">            vol_value = (ValFromdB(dB_input) - ValFromdB(dB_input) % <span class="number">0.1</span>)</span><br><span class="line">            <span class="comment">-- 执行音量调整函数</span></span><br><span class="line">            input_cal(vol_value)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            reaper.ShowMessageBox(<span class="string">"Check your input first!"</span>, <span class="string">"Warning"</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">            <span class="comment">-- 脚本惯例，刷新页面</span></span><br><span class="line">            reaper.UpdateArrange()</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        reaper.ShowMessageBox(<span class="string">"Please check your selected!"</span>, <span class="string">"Warning"</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h3 id="4-5-绘制-GUI"><a href="#4-5-绘制-GUI" class="headerlink" title="4.5. 绘制 GUI"></a>4.5. 绘制 GUI</h3><p>在 ReaPack 中可以找到由 Adam Lovatt 开发的 Lokasenna_GUI Builder，这是一个专门为 ReaScript 创建 GUI 的工具。目前它的第三版改名为 Scythe 也已经发布，但目前看起来只能用纯代码进行开发，有兴趣的朋友亦可自己尝试。<br>在 Action List 里找到它并打开，我们看一下它的界面。<br><img src="/images/GUI%20Builder.png" alt="GUI Builder"></p>
<p>本例中的程序只需三个控件：</p>
<ul>
<li>一行文字用来提示用户在这里输入，并提示数值范围</li>
<li>文本框作为输入框</li>
<li>按钮用来执行脚本</li>
</ul>
<p><img src="/images/Project%20Settings.png" alt="Project Settings"><br>先调整一下窗体大小为合适的尺寸，在 Settings - Project Settings 中设置 Width 和 Height 分别为400和200。并更改窗体 Name 为 Batch Change Volume。<br><img src="/images/%E5%AE%8C%E6%88%90%E5%90%8E%E7%9A%84GUI%E7%BC%96%E8%BE%91%E5%99%A8.png" alt="完成后的GUI编辑器"></p>
<p>在布局中添加所需的控件，你会发现 GUI Builder 中的文本框左边是自带文字部分，所以我们实际上只需添加两个控件即可（Textbox 和 Button）。<br>右键点击窗体后选取需要的控件名，添加控件完成后按住 Shift 拖拽控件到合适的位置。之后按需更改尺寸大小，并对控件的名称与尺寸进行修改。<br><strong>注：按钮处的 Name 属性应填写为 input_value，GUI 中显示的名字以 Caption 为准，请自行设置。</strong><br><img src="/images/Export.png" alt="Export"></p>
<p>当操作结束后，点击 File - Export 导出为 Change_Volume.lua 文件，我们的 GUI 就创建完成了。想找到创建好的 GUI 文件，需要在 Reaper 选项中显示资源路径，随后打开 <code>REAPER/Scripts/ReaTeam Scripts/Development/Lokasenna_GUI v2/Developer Tools/GUI Builder</code> 目录，即可找到制作好的文件，后缀名是 <code>.lua</code>。<br>Windows 用户也可按照类似的路径寻找到 GUI 文件所在。</p>
<h3 id="4-6-连接-GUI-与功能代码"><a href="#4-6-连接-GUI-与功能代码" class="headerlink" title="4.6. 连接 GUI 与功能代码"></a>4.6. 连接 GUI 与功能代码</h3><p>现在打开 GUI 文件，在这里我通过 VS Code 进行编辑。为了演示简单，我们不采用引用刚创建好的 Change_Volume.lua 文件的方式，直接把上面编写好的功能代码先复制到 GUI 代码中我标记的地方。<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> lib_path = reaper.GetExtState(<span class="string">"Lokasenna_GUI"</span>, <span class="string">"lib_path_v2"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> lib_path <span class="keyword">or</span> lib_path == <span class="string">""</span> <span class="keyword">then</span></span><br><span class="line">    reaper.MB(<span class="string">"Couldn't load the Lokasenna_GUI library. Please install 'Lokasenna's GUI library v2 for Lua', available on ReaPack, then run the 'Set Lokasenna_GUI v2 library path.lua' script in your Action List."</span>, <span class="string">"Whoops!"</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">loadfile</span>(lib_path .. <span class="string">"Core.lua"</span>)()</span><br><span class="line"></span><br><span class="line">GUI.req(<span class="string">"Classes/Class - Button.lua"</span>)()</span><br><span class="line">GUI.req(<span class="string">"Classes/Class - Textbox.lua"</span>)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> missing_lib <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">GUI.name = <span class="string">"Batch Change Volume"</span></span><br><span class="line">GUI.x, GUI.y, GUI.w, GUI.h = <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">200</span></span><br><span class="line">GUI.anchor, GUI.corner = <span class="string">"mouse"</span>, <span class="string">"C"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将功能代码复制到这里</span></span><br><span class="line"></span><br><span class="line">GUI.New(<span class="string">"Do it!"</span>, <span class="string">"Button"</span>, &#123;</span><br><span class="line">    z = <span class="number">11</span>,</span><br><span class="line">    x = <span class="number">144</span>,</span><br><span class="line">    y = <span class="number">112</span>,</span><br><span class="line">    w = <span class="number">100</span>,</span><br><span class="line">    h = <span class="number">50</span>,</span><br><span class="line">    caption = <span class="string">"Do it!"</span>,</span><br><span class="line">    font = <span class="number">3</span>,</span><br><span class="line">    col_txt = <span class="string">"txt"</span>,</span><br><span class="line">    col_fill = <span class="string">"elm_frame"</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">GUI.New(<span class="string">"input_value"</span>, <span class="string">"Textbox"</span>, &#123;</span><br><span class="line">    z = <span class="number">11</span>,</span><br><span class="line">    x = <span class="number">192</span>,</span><br><span class="line">    y = <span class="number">64</span>,</span><br><span class="line">    w = <span class="number">96</span>,</span><br><span class="line">    h = <span class="number">20</span>,</span><br><span class="line">    caption = <span class="string">"Volume (&lt;12dB)    "</span>,</span><br><span class="line">    cap_pos = <span class="string">"left"</span>,</span><br><span class="line">    font_a = <span class="number">3</span>,</span><br><span class="line">    font_b = <span class="string">"monospace"</span>,</span><br><span class="line">    color = <span class="string">"txt"</span>,</span><br><span class="line">    bg = <span class="string">"wnd_bg"</span>,</span><br><span class="line">    shadow = <span class="literal">true</span>,</span><br><span class="line">    pad = <span class="number">4</span>,</span><br><span class="line">    undo_limit = <span class="number">20</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">GUI.Init()</span><br><span class="line">GUI.Main()</span><br></pre></td></tr></table></figure></p>
<p>代码复制过来了，但 GUI 怎么和代码之间产生互动呢？<br><strong>根据逻辑推断我们可想出，按钮肯定是负责主函数的执行，而文本框负责接收用户输入的数据，并把这个数据传递给函数内部的变量 <code>dB_input</code>。</strong><br>观察代码，其中只有 <code>GUI.New</code> 两处地方需要注意，因为这是按钮的代码实现区。<br>首先，我们先修改按钮处的代码，为 Button 增加一个新的属性，<code>func = main</code>。<br>（为了节约篇幅，功能代码以上的部分省略。）<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 功能代码及上面的代码块省略</span></span><br><span class="line"></span><br><span class="line">GUI.New(<span class="string">"Do it!"</span>, <span class="string">"Button"</span>, &#123;</span><br><span class="line">    z = <span class="number">11</span>,</span><br><span class="line">    x = <span class="number">144</span>,</span><br><span class="line">    y = <span class="number">112</span>,</span><br><span class="line">    w = <span class="number">100</span>,</span><br><span class="line">    h = <span class="number">50</span>,</span><br><span class="line">    caption = <span class="string">"Do it!"</span>,</span><br><span class="line">    font = <span class="number">3</span>,</span><br><span class="line">    col_txt = <span class="string">"txt"</span>,</span><br><span class="line">    col_fill = <span class="string">"elm_frame"</span>,</span><br><span class="line">    <span class="comment">-- 对这个 Button 指派为触发 main() 函数，这里的函数触发不需要写括号</span></span><br><span class="line">    func = main</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">GUI.New(<span class="string">"input_value"</span>, <span class="string">"Textbox"</span>, &#123;</span><br><span class="line">    z = <span class="number">11</span>,</span><br><span class="line">    x = <span class="number">192</span>,</span><br><span class="line">    y = <span class="number">64</span>,</span><br><span class="line">    w = <span class="number">96</span>,</span><br><span class="line">    h = <span class="number">20</span>,</span><br><span class="line">    caption = <span class="string">"Volume (&lt;12dB)    "</span>,</span><br><span class="line">    cap_pos = <span class="string">"left"</span>,</span><br><span class="line">    font_a = <span class="number">3</span>,</span><br><span class="line">    font_b = <span class="string">"monospace"</span>,</span><br><span class="line">    color = <span class="string">"txt"</span>,</span><br><span class="line">    bg = <span class="string">"wnd_bg"</span>,</span><br><span class="line">    shadow = <span class="literal">true</span>,</span><br><span class="line">    pad = <span class="number">4</span>,</span><br><span class="line">    undo_limit = <span class="number">20</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">GUI.Init()</span><br><span class="line">GUI.Main()</span><br></pre></td></tr></table></figure></p>
<p>之后我们需要让程序里的变量 <code>dB_input</code> 能够获取文本框控件 <code>input_value</code> 中的值，于是我们要在 <code>main()</code> 函数中加入一行 <code>local dB_input = tonumber(GUI.Val(&quot;input_value&quot;))</code>。<br>以下是最终完成的完整代码：<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> lib_path = reaper.GetExtState(<span class="string">"Lokasenna_GUI"</span>, <span class="string">"lib_path_v2"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> lib_path <span class="keyword">or</span> lib_path == <span class="string">""</span> <span class="keyword">then</span></span><br><span class="line">    reaper.MB(<span class="string">"Couldn't load the Lokasenna_GUI library. Please install 'Lokasenna's GUI library v2 for Lua', available on ReaPack, then run the 'Set Lokasenna_GUI v2 library path.lua' script in your Action List."</span>, <span class="string">"Whoops!"</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="built_in">loadfile</span>(lib_path .. <span class="string">"Core.lua"</span>)()</span><br><span class="line"></span><br><span class="line">GUI.req(<span class="string">"Classes/Class - Button.lua"</span>)()</span><br><span class="line">GUI.req(<span class="string">"Classes/Class - Textbox.lua"</span>)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> missing_lib <span class="keyword">then</span> <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">GUI.name = <span class="string">"Batch Change Volume"</span></span><br><span class="line">GUI.x, GUI.y, GUI.w, GUI.h = <span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">200</span></span><br><span class="line">GUI.anchor, GUI.corner = <span class="string">"mouse"</span>, <span class="string">"C"</span></span><br><span class="line"></span><br><span class="line">sel_item = &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ValFromdB</span><span class="params">(dB_input)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span>^(dB_input/<span class="number">20</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">VolChanger</span><span class="params">(vol_value)</span></span></span><br><span class="line">    reaper.Undo_BeginBlock()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i = <span class="number">1</span>, count_sel_items <span class="keyword">do</span></span><br><span class="line">    sel_item[i] = reaper.GetSelectedMediaItem(<span class="number">0</span>, i - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> w = <span class="number">1</span>, #sel_item <span class="keyword">do</span></span><br><span class="line">    reaper.SetMediaItemInfo_Value(sel_item[w], <span class="string">"D_VOL"</span>, vol_value)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    reaper.Undo_EndBlock(<span class="string">"Batch Volumes"</span>, <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">input_cal</span><span class="params">(vol_value)</span></span></span><br><span class="line">    <span class="keyword">if</span> (vol_value &gt; <span class="number">12</span>) <span class="keyword">then</span></span><br><span class="line">        VolChanger(<span class="number">12.05</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        VolChanger(vol_value)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">-- 注意这行代码，从控件 input_value 中获取了用户的输入值，因为默认输入值都会被转为 string，所以这里我先强制把它转为 number，以满足接下来我们的判断需求</span></span><br><span class="line">    <span class="keyword">local</span> dB_input = <span class="built_in">tonumber</span>(GUI.Val(<span class="string">"input_value"</span>))</span><br><span class="line"></span><br><span class="line">    count_sel_items = reaper.CountSelectedMediaItems(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> count_sel_items &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">local</span> t = <span class="built_in">type</span>(dB_input)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> t == <span class="string">"number"</span> <span class="keyword">then</span></span><br><span class="line">            vol_value = (ValFromdB(dB_input) - ValFromdB(dB_input) % <span class="number">0.1</span>)</span><br><span class="line">            input_cal(vol_value)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            reaper.ShowMessageBox(<span class="string">"Check your input first!"</span>, <span class="string">"Warning"</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        reaper.UpdateArrange()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        reaper.ShowMessageBox(<span class="string">"Please check your selected!"</span>, <span class="string">"Warning"</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">GUI.New(<span class="string">"do_it"</span>, <span class="string">"Button"</span>, &#123;</span><br><span class="line">    z = <span class="number">11</span>,</span><br><span class="line">    x = <span class="number">144</span>,</span><br><span class="line">    y = <span class="number">112</span>,</span><br><span class="line">    w = <span class="number">100</span>,</span><br><span class="line">    h = <span class="number">50</span>,</span><br><span class="line">    caption = <span class="string">"Do it!"</span>,</span><br><span class="line">    font = <span class="number">3</span>,</span><br><span class="line">    col_txt = <span class="string">"txt"</span>,</span><br><span class="line">    col_fill = <span class="string">"elm_frame"</span>,</span><br><span class="line">    func = main</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">GUI.New(<span class="string">"input_value"</span>, <span class="string">"Textbox"</span>, &#123;</span><br><span class="line">    z = <span class="number">11</span>,</span><br><span class="line">    x = <span class="number">192</span>,</span><br><span class="line">    y = <span class="number">64</span>,</span><br><span class="line">    w = <span class="number">96</span>,</span><br><span class="line">    h = <span class="number">20</span>,</span><br><span class="line">    caption = <span class="string">"Volume (&lt;12dB)    "</span>,</span><br><span class="line">    cap_pos = <span class="string">"left"</span>,</span><br><span class="line">    font_a = <span class="number">3</span>,</span><br><span class="line">    font_b = <span class="string">"monospace"</span>,</span><br><span class="line">    color = <span class="string">"txt"</span>,</span><br><span class="line">    bg = <span class="string">"wnd_bg"</span>,</span><br><span class="line">    shadow = <span class="literal">true</span>,</span><br><span class="line">    pad = <span class="number">4</span>,</span><br><span class="line">    undo_limit = <span class="number">20</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">GUI.Init()</span><br><span class="line">GUI.Main()</span><br></pre></td></tr></table></figure></p>
<h3 id="4-7-完成效果"><a href="#4-7-完成效果" class="headerlink" title="4.7. 完成效果"></a>4.7. 完成效果</h3><p>打开 Action List，加载之前创建的 Change_Volume.lua 脚本进 Action List。随后运行它，看一下它的执行效果。<br><img src="/images/%E8%84%9A%E6%9C%AC1.png" alt="脚本1"><br>主界面<br><img src="/images/%E8%84%9A%E6%9C%AC2.png" alt="脚本2"><br>当未选择对象时点击按钮的提示<br><img src="/images/%E8%84%9A%E6%9C%AC3.png" alt="脚本3"><br>当选择了对象，但输入的不是数字时点击按钮的提示<br><img src="/images/%E8%84%9A%E6%9C%AC4.png" alt="脚本4"><br>选中两个对象<br><img src="/images/%E8%84%9A%E6%9C%AC5.png" alt="脚本5"><br>输入-100，点击按钮，可见对象的音量已被调整</p>
<h2 id="通过举一反三学会更多脚本"><a href="#通过举一反三学会更多脚本" class="headerlink" title="通过举一反三学会更多脚本"></a>通过举一反三学会更多脚本</h2><p>脚本语言（如 Python、Lua 等）属于解释型语言，执行过程中与编译型语言预先编译不同，脚本语言只有在执行的时候才需要翻译为机器语言。<br>所以在 Reaper 中当你在编辑脚本时，你会发现所有的前辈们的代码都是以源码的方式展现在你面前，全部开源，毫无掩饰。<strong>当你在编写自己的脚本的时候，前辈们的代码会是最有效的参考。</strong><br>事实上，当你对某个脚本使用方法产生疑惑时，除了去 Cockos 论坛找原贴看介绍，脚本内的注释和更新 Log 一般也能找到答案。<br>鉴于本人的智商不太高，所以一直在用土办法（好记性不如烂笔头）学习。遇到有兴趣的脚本就开始对写注释以加深理解。<br><strong>建议在脚本学习过程中遵循以下步骤：</strong></p>
<ol>
<li>主动学习对自己的工作流提升有用的代码片段，并做注释或做笔记总结。</li>
<li>不要只看不写，练习阶段甚至可以尝试写一个已有的脚本，然后看看跟前辈们的代码差在哪里。</li>
<li>举一反三，把不同类型和不同作者脚本中用到的代码技巧总结后融会贯通。</li>
</ol>
<h2 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h2><p>在本系列文的第一篇中，部分思路受到 Robert Randolph 先生的 ReaScript 教程影响。Raymond Radet（X-Raym）基于 Reaper 5 的老 ReaScript 教程也曾在我入门时给予帮助。Moy 老师关于脚本的几篇实例讲解在去年时也对我很有启发。（以上排名无先后）<br><strong>在这里感谢他们在 Reaper 脚本编程领域付出的努力！</strong></p>
<h2 id="接下来讲什么？"><a href="#接下来讲什么？" class="headerlink" title="接下来讲什么？"></a>接下来讲什么？</h2><p>在本篇文章中，我们的 ReaScript 脚本构建基于 Lua，并且都是使用 Reaper 内部的编辑器和 GUI 设计工具实现的。<br>下一篇中，<strong>我们会通过 ReaScript 在 Python 中的第三方库 Reapy，在 Reaper 外实现 ReaScript API 的调用。</strong>在实际工作中有时我们可能需要在外部调用 Reaper 的功能，这样只需让用户面对我们的脚本程序就可以了，通过减少用户与 Reaper 本身的纠缠，在某些场景下可能会比较方便。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">溪夜</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xiye.art/2020/09/20/如何使用 ReaScript 进一步改善 Reaper 效率？（一）/">http://xiye.art/2020/09/20/如何使用 ReaScript 进一步改善 Reaper 效率？（一）/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xiye.art" target="_blank">溪夜的音频博客</a>！</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2020/09/21/如何使用 ReaScript 进一步改善 Reaper 效率？（二）/"><i class="fa fa-chevron-left">  </i><span>补完 Reaper 效率链的最后一环（二）使用 reapy</span></a></div><div class="next-post pull-right"><a href="/2020/09/05/WAAPI 一文通（二）/"><span>人人都能用 WAAPI（二）wwise.core 分支</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC80MDk4Ny8xNzUxMg=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2020 By 溪夜</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.6"></script><script src="/js/fancybox.js?version=1.5.6"></script><script src="/js/sidebar.js?version=1.5.6"></script><script src="/js/copy.js?version=1.5.6"></script><script src="/js/fireworks.js?version=1.5.6"></script><script src="/js/transition.js?version=1.5.6"></script><script src="/js/scroll.js?version=1.5.6"></script><script src="/js/head.js?version=1.5.6"></script><script src="/js/search/local-search.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>